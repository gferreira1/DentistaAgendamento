<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Agendar Consulta</title>
</head>
<body>
    <div class="container">
        <h1>Agendar Consulta</h1>
        <form id="formularioAgendamento" onsubmit="return false;">
            <div class="paciente">
                <label for="nomePaciente">Nome do Paciente:</label>
                <input type="text" id="nomePaciente" name="nomePaciente" required>
            </div>
            <div class="calendario">
                <label for="data">Data:</label>
                <input type="date" id="data" name="data" required>
            </div>
            <div class="procedimento">
                <label for="procedimento">Procedimento:</label>
                <select id="procedimento" name="procedimento" required>
                    <option value="limpeza">Limpeza</option>
                    <option value="obturação">Obturação</option>
                    <option value="tratamento_canal">Tratamento de Canal</option>
                    <option value="exame">Exame Odontológico</option>
                </select>
            </div>
            <h2>Horários Disponíveis:</h2>
            <ul class="horarios" id="horariosDisponiveis">
                <li>08:00 AM <button type="button" onclick="confirmarAgendamento('08:00 AM', this)">Selecionar</button></li>
                <li>09:00 AM <button type="button" onclick="confirmarAgendamento('09:00 AM', this)">Selecionar</button></li>
                <li>10:00 AM <button type="button" onclick="confirmarAgendamento('10:00 AM', this)">Selecionar</button></li>
                <li>11:00 AM <button type="button" onclick="confirmarAgendamento('11:00 AM', this)">Selecionar</button></li>
                <li>01:30 PM <button type="button" onclick="confirmarAgendamento('01:30 PM', this)">Selecionar</button></li>
                <li>02:30 PM <button type="button" onclick="confirmarAgendamento('02:30 PM', this)">Selecionar</button></li>
                <li>03:30 PM <button type="button" onclick="confirmarAgendamento('03:30 PM', this)">Selecionar</button></li>
                <li>04:30 PM <button type="button" onclick="confirmarAgendamento('04:30 PM', this)">Selecionar</button></li>
            </ul>
        </form>
        <div class="confirmar">
            <button class="confirm" onclick="enviarAgendamento()">Confirmar Agendamento</button>
        </div>
    </div>

    <div id="modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="fecharModal()">&times;</span>
            <h2>Confirmação de Agendamento</h2>
            <pre id="modal-text"></pre>
            <button onclick="fecharModal()">Fechar</button>
        </div>
    </div>

    <div id="bottom-nav">
        <button class="nav-button" aria-label="Home" onclick="window.location.href='agendamento.html'">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            <span>Home</span>
        </button>
        <button class="nav-button" aria-label="Search" onclick="window.location.href='lembrete.html'">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <span>Agenda</span>
        </button>
        <button class="nav-button" aria-label="Profile" onclick="window.location.href='agendadoutor.html'">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2C9.38 2 7.25 4.13 7.25 6.75C7.25 9.32 9.26 11.4 11.88 11.49C11.96 11.48 12.04 11.48 12.1 11.49C12.12 11.49 12.13 11.49 12.15 11.49C12.16 11.49 12.16 11.49 12.17 11.49C14.73 11.4 16.74 9.32 16.75 6.75C16.75 4.13 14.62 2 12 2Z"></path>
                <path d="M17.0809 14.1489C14.2909 12.2889 9.74094 12.2889 6.93094 14.1489C5.66094 14.9989 4.96094 16.1489 4.96094 17.3789C4.96094 18.6089 5.66094 19.7489 6.92094 20.5889C8.32094 21.5289 10.1609 21.9989 12.0009 21.9989C13.8409 21.9989 15.6809 21.5289 17.0809 20.5889C18.3409 19.7389 19.0409 18.5989 19.0409 17.3589C19.0309 16.1289 18.3409 14.9889 17.0809 14.1489Z"></path>
            </svg>
            <span>Profile</span>
        </button>
    </div>

    <script>
        let horarioSelecionado = '';

        function confirmarAgendamento(horario, button) {
            if (horarioSelecionado) {
                alert("Você já selecionou um horário.");
                return;
            }
            horarioSelecionado = horario; // Mantém o horário com AM/PM
            button.disabled = true; // Desabilita o botão
            alert(`Horário ${horario} selecionado.`);
        }

        async function enviarAgendamento() {
            const data = document.getElementById('data').value;
            const nomePaciente = document.getElementById('nomePaciente').value;
            const procedimento = document.getElementById('procedimento').value;

            if (!horarioSelecionado) {
                alert("Por favor, selecione um horário antes de confirmar.");
                return;
            }

            const dadosAgendamento = {
                "paciente": nomePaciente,
                "data": data,
                "hora": horarioSelecionado,
                "procedimento": procedimento
            };

            console.log("Dados do Agendamento:", dadosAgendamento); // Debugging

            try {
                console.log("Dados do Agendamento try:", dadosAgendamento); // Debugging
                const response = await fetch('https://www.codekst.com.br/agendamento', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(dadosAgendamento)
                });

                if (response) {
                    //const resultado = await response.json();
                    //document.getElementById('modal-text').innerText = `Consulta agendada com sucesso!\nNome: ${resultado.paciente || nomePaciente}\nHorário: ${resultado.hora || horarioSelecionado}\nData: ${resultado.data || data}\nProcedimento: ${resultado.procedimento || procedimento}`;
                    //document.getElementById('modal').style.display = 'flex';
                    const errorDetails = response.json();
                    console.error("Erro do servidor:", errorDetails);
                    alert("Erro ao agendar a consulta: " + errorDetails);
                } else {
                    const errorDetails = response.json();
                    console.error("Erro do servidor:", errorDetails);
                    alert("Erro ao agendar a consulta: " + errorDetails);
                }
            } catch (error) {
                console.log("Dados do Agendamento cath:", dadosAgendamento); // Debugging
                console.error("Erro na comunicação com o servidor:", error);
                alert("Erro na comunicação com o servidor.");
            }
        }

        function fecharModal() {
            document.getElementById('modal').style.display = 'none';
        }

        function confirmarAgendamento(horario, button) {
    if (horarioSelecionado) {
        alert("Você já selecionou um horário.");
        return;
    }
    horarioSelecionado = horario; // Mantém o horário com AM/PM
    button.disabled = true; // Desabilita o botão do horário selecionado

    // Desabilitar todos os outros botões
    const buttons = document.querySelectorAll('#horariosDisponiveis button');
    buttons.forEach(btn => {
        if (btn !== button) {
            btn.disabled = true; // Desabilita todos os outros botões
        }
    });

    alert(`Horário ${horario} selecionado.`);
}
    </script>
</body>
</html>
